# Webnovel Writer

[![License](https://img.shields.io/badge/License-GPL%20v3-blue.svg)](LICENSE)
[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/)
[![Claude Code](https://img.shields.io/badge/Claude%20Code-Compatible-purple.svg)](https://claude.ai/claude-code)

åŸºäºŽ Claude Code çš„é•¿ç¯‡ç½‘æ–‡è¾…åŠ©åˆ›ä½œç³»ç»Ÿï¼Œè§£å†³ AI å†™ä½œä¸­çš„ã€Œé—å¿˜ã€å’Œã€Œå¹»è§‰ã€é—®é¢˜ï¼Œæ”¯æŒ **200 ä¸‡å­—é‡çº§** è¿žè½½åˆ›ä½œã€‚

---

## ç›®å½•

- [æ ¸å¿ƒç†å¿µ](#æ ¸å¿ƒç†å¿µ)
- [ç³»ç»Ÿæž¶æž„](#ç³»ç»Ÿæž¶æž„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å‘½ä»¤è¯¦è§£](#å‘½ä»¤è¯¦è§£)
- [åŒ Agent æž¶æž„](#åŒ-agent-æž¶æž„)
- [äº”ç»´å¹¶è¡Œå®¡æŸ¥](#äº”ç»´å¹¶è¡Œå®¡æŸ¥)
- [RAG æ£€ç´¢ç³»ç»Ÿ](#rag-æ£€ç´¢ç³»ç»Ÿ)
- [é¢˜ææ¨¡æ¿](#é¢˜ææ¨¡æ¿)
- [é…ç½®è¯´æ˜Ž](#é…ç½®è¯´æ˜Ž)
- [é¡¹ç›®ç»“æž„](#é¡¹ç›®ç»“æž„)
- [æ•…éšœæ¢å¤](#æ•…éšœæ¢å¤)
- [License](#license)

---

## æ ¸å¿ƒç†å¿µ

### é˜²å¹»è§‰ä¸‰å®šå¾‹

| å®šå¾‹ | è¯´æ˜Ž | æ‰§è¡Œæ–¹å¼ |
|------|------|---------|
| **å¤§çº²å³æ³•å¾‹** | éµå¾ªå¤§çº²ï¼Œä¸æ“…è‡ªå‘æŒ¥ | Context Agent å¼ºåˆ¶åŠ è½½ç« èŠ‚å¤§çº² |
| **è®¾å®šå³ç‰©ç†** | éµå®ˆè®¾å®šï¼Œä¸è‡ªç›¸çŸ›ç›¾ | Consistency Checker å®žæ—¶æ ¡éªŒ |
| **å‘æ˜Žéœ€è¯†åˆ«** | æ–°å®žä½“å¿…é¡»å…¥åº“ç®¡ç† | Data Agent è‡ªåŠ¨æå–å¹¶æ¶ˆæ­§ |

### Strand Weave èŠ‚å¥ç³»ç»Ÿ

ä¸‰çº¿äº¤ç»‡çš„å™äº‹èŠ‚å¥æŽ§åˆ¶ï¼š

| Strand | å«ä¹‰ | ç†æƒ³å æ¯” | è¯´æ˜Ž |
|--------|------|---------|------|
| **Quest** | ä¸»çº¿å‰§æƒ… | 60% | æŽ¨åŠ¨æ ¸å¿ƒå†²çª |
| **Fire** | æ„Ÿæƒ…çº¿ | 20% | äººç‰©å…³ç³»å‘å±• |
| **Constellation** | ä¸–ç•Œè§‚æ‰©å±• | 20% | èƒŒæ™¯/åŠ¿åŠ›/è®¾å®š |

**èŠ‚å¥çº¢çº¿**ï¼š
- Quest è¿žç»­ä¸è¶…è¿‡ 5 ç« 
- Fire æ–­æ¡£ä¸è¶…è¿‡ 10 ç« 
- æ¯ç« è‡³å°‘åŒ…å« 2 ç§ Strand

---

## ç³»ç»Ÿæž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Claude Code                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Skills (6ä¸ª)                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  init    â”‚ â”‚   plan   â”‚ â”‚  write   â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  review  â”‚ â”‚  query   â”‚ â”‚  resume  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agents (8ä¸ª)                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Context Agent  â”‚  â”‚   Data Agent    â”‚                   â”‚
â”‚  â”‚     (è¯»å–)      â”‚  â”‚     (å†™å…¥)      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ çˆ½ç‚¹  â”‚ â”‚ ä¸€è‡´æ€§â”‚ â”‚ èŠ‚å¥  â”‚ â”‚  OOC  â”‚ â”‚ è¿žè´¯æ€§â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Data Layer                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚state.jsonâ”‚ â”‚ index.db â”‚ â”‚vectors.dbâ”‚                     â”‚
â”‚  â”‚ (çŠ¶æ€)   â”‚ â”‚ (ç´¢å¼•)   â”‚ â”‚ (å‘é‡)   â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

| ä¾èµ– | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜Ž |
|------|---------|------|
| Python | >= 3.8 | æ•°æ®å¤„ç†è„šæœ¬è¿è¡ŒçŽ¯å¢ƒ |
| Claude Code | æœ€æ–°ç‰ˆ | Anthropic å®˜æ–¹ CLI å·¥å…· |
| Git | ä»»æ„ç‰ˆæœ¬ | ç‰ˆæœ¬æŽ§åˆ¶å’Œç« èŠ‚å¤‡ä»½ |

### 1. å®‰è£…

```bash
# è¿›å…¥ä½ çš„å°è¯´é¡¹ç›®ç›®å½•
cd your-novel-project

# å…‹éš†æ’ä»¶åˆ° .claude ç›®å½•
git clone https://github.com/lingfengQAQ/webnovel-writer.git .claude

# å®‰è£… Python ä¾èµ–
pip install -r .claude/scripts/requirements.txt
```

**Python ä¾èµ–è¯´æ˜Ž**ï¼š

| åŒ…å | ç”¨é€” |
|------|------|
| aiohttp | å¼‚æ­¥ HTTP å®¢æˆ·ç«¯ï¼Œç”¨äºŽ Embedding/Reranker API è°ƒç”¨ |
| filelock | æ–‡ä»¶é”ï¼Œé˜²æ­¢ state.json å¹¶å‘å†™å…¥å†²çª |

### 2. åˆå§‹åŒ–é¡¹ç›®

```bash
# åœ¨ Claude Code ä¸­æ‰§è¡Œ
/webnovel-init
```

ç³»ç»Ÿä¼šå¼•å¯¼ä½ å®Œæˆï¼š
- é€‰æ‹©åˆå§‹åŒ–æ¨¡å¼ï¼ˆQuick/Standard/Deepï¼‰
- é€‰æ‹©é¢˜æç±»åž‹
- è®¾è®¡é‡‘æ‰‹æŒ‡/æ ¸å¿ƒå–ç‚¹
- ç”Ÿæˆé¡¹ç›®ç»“æž„å’Œè®¾å®šæ¨¡æ¿

### 3. è§„åˆ’å¤§çº²

```bash
# è§„åˆ’ç¬¬1å·å¤§çº²
/webnovel-plan 1
```

### 4. å¼€å§‹åˆ›ä½œ

```bash
# åˆ›ä½œç¬¬1ç« 
/webnovel-write 1
```

### 5. è´¨é‡å®¡æŸ¥ï¼ˆå¯é€‰ï¼‰

```bash
# å®¡æŸ¥ç¬¬1-5ç« 
/webnovel-review 1-5
```

---

## å‘½ä»¤è¯¦è§£

### /webnovel-init - é¡¹ç›®åˆå§‹åŒ–

åˆå§‹åŒ–é¡¹ç›®ç»“æž„ã€é¢˜ææ¨¡æ¿ã€ä¸–ç•Œè§‚è®¾å®šã€‚

**åˆå§‹åŒ–æ¨¡å¼**ï¼š

| æ¨¡å¼ | æ—¶é—´ | å†…å®¹ |
|------|------|------|
| âš¡ Quick | 5åˆ†é’Ÿ | åŸºç¡€ç»“æž„ + æ ¸å¿ƒå–ç‚¹ |
| ðŸ“ Standard | 15-20åˆ†é’Ÿ | + é‡‘æ‰‹æŒ‡è®¾è®¡ + é¢˜ææ¨¡æ¿ |
| ðŸŽ¯ Deep | 30-45åˆ†é’Ÿ | + æ·±åº¦ä¸–ç•Œè§‚ + åˆ›æ„éªŒè¯ |

**äº§å‡ºæ–‡ä»¶**ï¼š
- `.webnovel/state.json` - é¡¹ç›®çŠ¶æ€
- `è®¾å®šé›†/` - ä¸–ç•Œè§‚ã€åŠ›é‡ä½“ç³»ã€è§’è‰²å¡
- `å¤§çº²/æ€»çº².md` - æ•…äº‹æ¡†æž¶

---

### /webnovel-plan [å·å·] - å¤§çº²è§„åˆ’

åˆ¶å®šè¯¦ç»†çš„å·å¤§çº²ï¼Œè§„åˆ’çˆ½ç‚¹åˆ†å¸ƒå’ŒèŠ‚å¥ã€‚

```bash
/webnovel-plan 1        # è§„åˆ’ç¬¬1å·
/webnovel-plan 2-3      # è§„åˆ’ç¬¬2-3å·
```

**äº§å‡º**ï¼š
- `å¤§çº²/ç¬¬Nå·-è¯¦ç»†å¤§çº².md`
- æ¯ç« ç›®æ ‡ã€çˆ½ç‚¹è®¾è®¡ã€Strand ç±»åž‹
- æ–°å¢žå®žä½“é¢„å‘Š

---

### /webnovel-write [ç« å·] - ç« èŠ‚åˆ›ä½œ

é‡‡ç”¨åŒ Agent æž¶æž„çš„è‡ªåŠ¨åŒ–ç« èŠ‚åˆ›ä½œã€‚

```bash
/webnovel-write 1       # åˆ›ä½œç¬¬1ç« 
/webnovel-write 45      # åˆ›ä½œç¬¬45ç« 
```

**åˆ›ä½œæµç¨‹**ï¼š

```
Step 1: Context Agent æœé›†ä¸Šä¸‹æ–‡
        â†“
Step 2: ç”Ÿæˆ 3000-5000 å­—æ­£æ–‡
        â†“
Step 3: 5 Agent å¹¶è¡Œå®¡æŸ¥
        â†“
Step 4: æ¶¦è‰² + AI ç—•è¿¹æ£€æµ‹
        â†“
Step 5: Data Agent æå–å®žä½“/æ›´æ–°ç´¢å¼•
        â†“
Step 6: Git è‡ªåŠ¨æäº¤å¤‡ä»½
```

**äº§å‡º**ï¼š
- `æ­£æ–‡/ç¬¬Nç« -æ ‡é¢˜.md`
- ç« èŠ‚æœ«å°¾è‡ªåŠ¨é™„åŠ æ‘˜è¦

---

### /webnovel-review [èŒƒå›´] - è´¨é‡å®¡æŸ¥

å¯¹å·²å®Œæˆç« èŠ‚è¿›è¡Œå¤šç»´åº¦æ·±åº¦æ‰«æã€‚

```bash
/webnovel-review 1-5    # å®¡æŸ¥ç¬¬1-5ç« 
/webnovel-review 45     # å®¡æŸ¥å•ç« 
```

**å®¡æŸ¥ç»´åº¦**ï¼š
- çˆ½ç‚¹å¯†åº¦ä¸Žè´¨é‡
- è®¾å®šä¸€è‡´æ€§
- èŠ‚å¥ Strand åˆ†å¸ƒ
- äººç‰© OOC æ£€æµ‹
- åœºæ™¯è¿žè´¯æ€§

---

### /webnovel-query [å…³é”®è¯] - ä¿¡æ¯æŸ¥è¯¢

æŸ¥è¯¢è§’è‰²ã€å¢ƒç•Œã€ä¼ç¬”ã€ç³»ç»ŸçŠ¶æ€ç­‰è¿è¡Œæ—¶ä¿¡æ¯ã€‚

```bash
/webnovel-query è§ç‚Ž         # æŸ¥è¯¢è§’è‰²ä¿¡æ¯
/webnovel-query ä¼ç¬”         # æŸ¥çœ‹å¾…å›žæ”¶ä¼ç¬”
/webnovel-query ç´§æ€¥         # æŸ¥çœ‹ç´§æ€¥ä¼ç¬”
```

---

### /webnovel-resume - ä»»åŠ¡æ¢å¤

åœ¨ä»»åŠ¡ä¸­æ–­æ—¶æ£€æµ‹ä¸­æ–­ç‚¹å¹¶æä¾›å®‰å…¨æ¢å¤é€‰é¡¹ã€‚

```bash
/webnovel-resume
```

**æ¢å¤é€‰é¡¹**ï¼š
- ä»Žæ–­ç‚¹ç»§ç»­
- å›žæ»šåˆ°ä¸Šä¸€ä¸ªå®‰å…¨ç‚¹
- é‡æ–°å¼€å§‹å½“å‰æ­¥éª¤

---

## åŒ Agent æž¶æž„

### Context Agentï¼ˆä¸Šä¸‹æ–‡åŒ…å·¥ç¨‹å¸ˆï¼‰

**èŒè´£**ï¼šä¸ºå†™ä½œå‡†å¤‡ç²¾å‡†çš„ä¸Šä¸‹æ–‡

**å·¥ä½œæµç¨‹**ï¼š
1. è¯»å–æœ¬ç« å¤§çº²ï¼Œåˆ†æžéœ€è¦ä»€ä¹ˆä¿¡æ¯
2. ä»Ž `state.json` èŽ·å–ä¸»è§’çŠ¶æ€å¿«ç…§
3. è°ƒç”¨ `index.db` (v5.1 schema) æŸ¥è¯¢ç›¸å…³å®žä½“å’Œåˆ«å
4. è°ƒç”¨ RAG è¯­ä¹‰æ£€ç´¢ç›¸å…³åŽ†å²åœºæ™¯
5. æœç´¢è®¾å®šé›†èŽ·å–ç›¸å…³è®¾å®š
6. è¯„ä¼°ä¼ç¬”ç´§æ€¥åº¦
7. ç»„è£…ä¸Šä¸‹æ–‡åŒ… JSON

**è¾“å‡ºç»“æž„**ï¼š
```json
{
  "core": {
    "chapter_outline": "æœ¬ç« å¤§çº²",
    "protagonist_snapshot": {...},
    "recent_summaries": [...]
  },
  "scene": {
    "location_context": {...},
    "appearing_characters": [...],
    "urgent_foreshadowing": [...]
  },
  "global": {
    "worldview_skeleton": "...",
    "power_system_skeleton": "...",
    "style_contract_ref": "..."
  },
  "rag": [...],
  "alerts": {
    "disambiguation_warnings": [...],
    "disambiguation_pending": [...]
  }
}
```

---

### Data Agentï¼ˆæ•°æ®é“¾å·¥ç¨‹å¸ˆï¼‰

**èŒè´£**ï¼šä»Žæ­£æ–‡ä¸­è¯­ä¹‰åŒ–æå–å®žä½“å¹¶åŒæ­¥çŠ¶æ€

**å·¥ä½œæµç¨‹**ï¼š
1. **å®žä½“æå–**ï¼šè¯†åˆ«è§’è‰²/åœ°ç‚¹/ç‰©å“/æ‹›å¼/åŠ¿åŠ›
2. **å®žä½“æ¶ˆæ­§**ï¼š
   - é«˜ç½®ä¿¡åº¦ (>0.8)ï¼šè‡ªåŠ¨é‡‡ç”¨
   - ä¸­ç½®ä¿¡åº¦ (0.5-0.8)ï¼šé‡‡ç”¨ä½†è®°å½• warning
   - ä½Žç½®ä¿¡åº¦ (<0.5)ï¼šæ ‡è®°å¾…äººå·¥ç¡®è®¤
3. **å†™å…¥å­˜å‚¨**ï¼šæ›´æ–° `index.db` (entities/aliases/state_changes)
4. **åœºæ™¯åˆ‡ç‰‡**ï¼šæŒ‰åœ°ç‚¹/æ—¶é—´/è§†è§’åˆ‡åˆ†åœºæ™¯
5. **å‘é‡åµŒå…¥**ï¼šè°ƒç”¨ RAG å­˜å…¥å‘é‡åº“

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "entities_extracted": [...],
  "state_changes": [...],
  "scenes": [...],
  "warnings": [...],
  "stats": {
    "new_entities": 3,
    "updated_entities": 2,
    "scenes_created": 4
  }
}
```

---

## äº”ç»´å¹¶è¡Œå®¡æŸ¥

| Checker | æ£€æŸ¥å†…å®¹ | å…³é”®æŒ‡æ ‡ |
|---------|---------|---------|
| **High-point Checker** | çˆ½ç‚¹å¯†åº¦ä¸Žè´¨é‡ | 6ç§æ‰§è¡Œæ¨¡å¼ã€30/40/30ç»“æž„ |
| **Consistency Checker** | æˆ˜åŠ›/åœ°ç‚¹/æ—¶é—´çº¿ | è®¾å®šå³ç‰©ç†å®šå¾‹ |
| **Pacing Checker** | Strand æ¯”ä¾‹åˆ†å¸ƒ | Quest/Fire/Constellation |
| **OOC Checker** | äººç‰©è¨€è¡Œæ˜¯å¦ç¬¦åˆäººè®¾ | è§’è‰²å¡ç‰‡å¯¹ç…§ |
| **Continuity Checker** | åœºæ™¯è½¬æ¢æµç•…åº¦ | ä¼ç¬”å›žæ”¶æƒ…å†µ |

### çˆ½ç‚¹å…­å¤§æ‰§è¡Œæ¨¡å¼

| æ¨¡å¼ | æ¨¡å¼æ ‡è¯† | å…¸åž‹è§¦å‘ |
|------|---------|---------|
| è£…é€¼æ‰“è„¸ | Flex & Counter | å˜²è®½ â†’ åè½¬ â†’ éœ‡æƒŠ |
| æ‰®çŒªåƒè™Ž | Underdog Reveal | ç¤ºå¼± â†’ æš´éœ² â†’ ç¢¾åŽ‹ |
| è¶Šçº§åæ€ | Underdog Victory | å·®è· â†’ ç­–ç•¥ â†’ é€†è½¬ |
| æ‰“è„¸æƒå¨ | Authority Challenge | æƒå¨ â†’ æŒ‘æˆ˜ â†’ æˆåŠŸ |
| åæ´¾ç¿»è½¦ | Villain Downfall | å¾—æ„ â†’ åæ€ â†’ è½å¹• |
| ç”œèœœè¶…é¢„æœŸ | Sweet Surprise | æœŸå¾… â†’ è¶…é¢„æœŸ â†’ å‡åŽ |

### çˆ½ç‚¹å¯†åº¦åŸºå‡†

- **æ¯ç« **ï¼šâ‰¥ 1 cool-point (ä»»ä½•å•ä¸€æ¨¡å¼)
- **æ¯5ç« **ï¼šâ‰¥ 1 combo cool-point (2ç§ä»¥ä¸Šæ¨¡å¼å åŠ )
- **æ¯10ç« **ï¼šâ‰¥ 1 milestone victory (æ”¹å˜ä¸»è§’åœ°ä½çš„é˜¶æ®µæ€§èƒœåˆ©)

---

## RAG æ£€ç´¢ç³»ç»Ÿ

æ··åˆæ£€ç´¢ç³»ç»Ÿï¼Œæ”¯æŒè¯­ä¹‰æœç´¢åŽ†å²åœºæ™¯ï¼š

### æž¶æž„

```
æŸ¥è¯¢ â†’ [å‘é‡æ£€ç´¢] + [BM25å…³é”®è¯] â†’ RRFèžåˆ â†’ RerankæŽ’åº â†’ Top-Kç»“æžœ
```

### é…ç½®

| ç»„ä»¶ | é»˜è®¤æä¾›å•† | é»˜è®¤æ¨¡åž‹ |
|-----|----------|---------|
| Embedding | ModelScope (é­”æ­) | Qwen/Qwen3-Embedding-8B |
| Reranker | Jina AI | jina-reranker-v3 |

### çŽ¯å¢ƒå˜é‡

```bash
# .env æ–‡ä»¶

# Embedding é…ç½® (é»˜è®¤ä½¿ç”¨é­”æ­)
EMBED_API_TYPE=openai          # openai å…¼å®¹æŽ¥å£
EMBED_BASE_URL=https://api-inference.modelscope.cn/v1
EMBED_MODEL=Qwen/Qwen3-Embedding-8B
EMBED_API_KEY=your-modelscope-token

# Reranker é…ç½®
RERANK_API_TYPE=openai         # openai (å…¼å®¹ Jina/Cohere)
RERANK_BASE_URL=https://api.jina.ai/v1
RERANK_MODEL=jina-reranker-v3
RERANK_API_KEY=jina_xxx
```

### ä½¿ç”¨æ–¹å¼

- **Context Agent** è‡ªåŠ¨è°ƒç”¨ RAG æ£€ç´¢ç›¸å…³åŽ†å²åœºæ™¯
- **Data Agent** è‡ªåŠ¨å°†ç« èŠ‚åœºæ™¯å‘é‡åŒ–å­˜å…¥æ•°æ®åº“
- æ”¯æŒå¤±è´¥é‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ï¼Œæœ€å¤š3æ¬¡ï¼‰

---

## é¢˜ææ¨¡æ¿

ç³»ç»Ÿå†…ç½® 10+ ç§çƒ­é—¨ç½‘æ–‡é¢˜ææ¨¡æ¿ï¼š

| é¢˜æ | è¯´æ˜Ž |
|------|------|
| ä¿®ä»™ | å¢ƒç•Œä½“ç³»ã€å®—é—¨ä½“ç³»ã€ç§˜å¢ƒå¤ºå® |
| ç³»ç»Ÿæµ | é¢æ¿è®¾è®¡ã€ä»»åŠ¡ç³»ç»Ÿã€å¥–åŠ±æœºåˆ¶ |
| éƒ½å¸‚å¼‚èƒ½ | éšè—å®žåŠ›ã€å®¶æ—åŠ¿åŠ›ã€æƒè´µäº’åŠ¨ |
| è§„åˆ™æ€ªè°ˆ | è§„åˆ™æŽ¨ç†ã€ææ€–æ°›å›´ã€åæ€æ€ªè°ˆ |
| æ›¿èº«æ–‡ | äº”é˜¶æ®µå¿ƒç†çº¿ã€è¿½å¦»ç«è‘¬åœºã€èº«ä»½åè½¬ |
| å¤šå­å¤šç¦ | åŽå®«ç³»ç»Ÿã€å­å—£å…»æˆã€ç³»ç»Ÿå¥–åŠ± |
| é»‘æš—é¢˜æ | åžå™¬è¿›åŒ–ã€åŠ¿åŠ›å»ºç«‹ã€åŽ‹æ‰¬æ¯”ä¾‹ |
| ... | æ›´å¤šæ¨¡æ¿æŒç»­æ›´æ–° |

---

## é…ç½®è¯´æ˜Ž

### æ ¸å¿ƒé…ç½® (`config.py`)

```python
# API è®¾ç½®
embed_concurrency = 50          # åµŒå…¥å¹¶å‘æ•°
cold_start_timeout = 120        # å†·å¯åŠ¨è¶…æ—¶(ç§’)
normal_timeout = 30             # æ­£å¸¸è¶…æ—¶(ç§’)
api_max_retries = 3             # æœ€å¤§é‡è¯•æ¬¡æ•°
api_retry_delay = 1.0           # é‡è¯•å»¶è¿Ÿ(ç§’)

# èŠ‚å¥çº¢çº¿
strand_quest_max_consecutive = 5   # Quest æœ€å¤§è¿žç»­ç« æ•°
strand_fire_max_gap = 10           # Fire æœ€å¤§æ–­æ¡£ç« æ•°

# çˆ½ç‚¹å¯†åº¦
pacing_words_per_point = (1000, 2000)  # æ¯ä¸ªçˆ½ç‚¹å­—æ•°èŒƒå›´

# å®žä½“ç½®ä¿¡åº¦
extraction_confidence_high = 0.8   # é«˜ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆè‡ªåŠ¨é‡‡ç”¨ï¼‰
extraction_confidence_low = 0.5    # ä½Žç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆå¾…ç¡®è®¤ï¼‰

# ä¸Šä¸‹æ–‡çª—å£
context_recent_summaries_window = 5   # æœ€è¿‘æ‘˜è¦æ•°é‡
context_max_appearing_characters = 10 # æœ€å¤§å‡ºåœºè§’è‰²æ•°
context_max_urgent_foreshadowing = 5  # æœ€å¤§ç´§æ€¥ä¼ç¬”æ•°
```

---

## é¡¹ç›®ç»“æž„

```
your-novel-project/
â”œâ”€â”€ .claude/                    # æ’ä»¶ç›®å½•
â”‚   â”œâ”€â”€ agents/                 # 8 ä¸ªä¸“èŒ Agent
â”‚   â”‚   â”œâ”€â”€ context-agent.md    # ä¸Šä¸‹æ–‡åŒ…å·¥ç¨‹å¸ˆ
â”‚   â”‚   â”œâ”€â”€ data-agent.md       # æ•°æ®é“¾å·¥ç¨‹å¸ˆ
â”‚   â”‚   â”œâ”€â”€ high-point-checker.md
â”‚   â”‚   â”œâ”€â”€ consistency-checker.md
â”‚   â”‚   â”œâ”€â”€ pacing-checker.md
â”‚   â”‚   â”œâ”€â”€ ooc-checker.md
â”‚   â”‚   â””â”€â”€ continuity-checker.md
â”‚   â”œâ”€â”€ skills/                 # 6 ä¸ªæ ¸å¿ƒ Skill
â”‚   â”‚   â”œâ”€â”€ webnovel-init/
â”‚   â”‚   â”œâ”€â”€ webnovel-plan/
â”‚   â”‚   â”œâ”€â”€ webnovel-write/
â”‚   â”‚   â”œâ”€â”€ webnovel-review/
â”‚   â”‚   â”œâ”€â”€ webnovel-query/
â”‚   â”‚   â””â”€â”€ webnovel-resume/
â”‚   â”œâ”€â”€ scripts/                # Python è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ data_modules/
â”‚   â”‚   â”‚   â”œâ”€â”€ index_manager.py    # SQLite ç´¢å¼•ç®¡ç† (v5.1)
â”‚   â”‚   â”‚   â”œâ”€â”€ rag_adapter.py      # RAG æ£€ç´¢å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ api_client.py       # API å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â””â”€â”€ config.py           # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ context_pack_builder.py # ä¸Šä¸‹æ–‡åŒ…æž„å»ºå™¨
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ templates/              # é¢˜ææ¨¡æ¿
â”‚   â”‚   â””â”€â”€ genres/
â”‚   â”‚       â”œâ”€â”€ ä¿®ä»™.md
â”‚   â”‚       â”œâ”€â”€ ç³»ç»Ÿæµ.md
â”‚   â”‚       â”œâ”€â”€ æ›¿èº«æ–‡.md
â”‚   â”‚       â”œâ”€â”€ å¤šå­å¤šç¦.md
â”‚   â”‚       â”œâ”€â”€ é»‘æš—é¢˜æ.md
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ references/             # å†™ä½œæŒ‡å—
â”‚       â”œâ”€â”€ strand-weave.md
â”‚       â”œâ”€â”€ cool-points-guide.md
â”‚       â””â”€â”€ ...
â”œâ”€â”€ .webnovel/                  # è¿è¡Œæ—¶æ•°æ®
â”‚   â”œâ”€â”€ state.json              # æƒå¨çŠ¶æ€ (< 5KB)
â”‚   â”œâ”€â”€ index.db                # SQLite ç´¢å¼•
â”‚   â””â”€â”€ vectors.db              # RAG å‘é‡åº“
â”œâ”€â”€ æ­£æ–‡/                       # ç« èŠ‚æ–‡ä»¶
â”‚   â”œâ”€â”€ ç¬¬1ç« -æ ‡é¢˜.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ å¤§çº²/                       # å·çº²/ç« çº²
â”‚   â”œâ”€â”€ æ€»çº².md
â”‚   â”œâ”€â”€ ç¬¬1å·-è¯¦ç»†å¤§çº².md
â”‚   â””â”€â”€ ...
â””â”€â”€ è®¾å®šé›†/                     # ä¸–ç•Œè§‚/è§’è‰²/åŠ›é‡ä½“ç³»
    â”œâ”€â”€ ä¸–ç•Œè§‚.md
    â”œâ”€â”€ åŠ›é‡ä½“ç³».md
    â””â”€â”€ è§’è‰²/
        â””â”€â”€ ...
```

---

## æ•…éšœæ¢å¤

### ç´¢å¼•é‡å»º

å½“ `index.db` æŸåæˆ–ä¸Žå®žé™…æ•°æ®ä¸ä¸€è‡´æ—¶ï¼š

```bash
# é‡æ–°å¤„ç†å•ç« 
python -m data_modules.index_manager process-chapter --chapter 1 --project-root "."

# æ‰¹é‡é‡æ–°å¤„ç†
for i in $(seq 1 50); do
  python -m data_modules.index_manager process-chapter --chapter $i --project-root "."
done

# æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡
python -m data_modules.index_manager stats --project-root "."
```

### å‘é‡é‡å»º

å½“ `vectors.db` æŸåæˆ–åµŒå…¥æ¨¡åž‹æ›´æ¢æ—¶ï¼š

```bash
# é‡æ–°ç´¢å¼•å•ç« 
python -m data_modules.rag_adapter index-chapter --chapter 1 --project-root "."

# æŸ¥çœ‹å‘é‡ç»Ÿè®¡
python -m data_modules.rag_adapter stats --project-root "."
```

### Git å›žæ»š

æ¯ç« è‡ªåŠ¨åˆ›å»º Git æ ‡ç­¾ï¼Œæ”¯æŒæŒ‰ç« å›žæ»šï¼š

```bash
# æŸ¥çœ‹ç« èŠ‚æ ‡ç­¾
git tag | grep "ch"

# å›žæ»šåˆ°ç¬¬45ç« 
git checkout ch0045
```

---

## ç‰ˆæœ¬åŽ†å²

### v5.1 (å½“å‰)
- SQLite å­˜å‚¨ï¼šentities/aliases/state_changes è¿ç§»åˆ° index.db
- state.json ç²¾ç®€è‡³ < 5KB
- API é‡è¯•æœºåˆ¶ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- 6 ç§çˆ½ç‚¹æ‰§è¡Œæ¨¡å¼

### v5.0
- åŒ Agent æž¶æž„ (Context + Data)
- çº¯æ­£æ–‡å†™ä½œï¼Œæ— éœ€ XML æ ‡ç­¾
- 5 ç»´å¹¶è¡Œå®¡æŸ¥

---

## License

GPL v3 - è¯¦è§ [LICENSE](LICENSE)

---

## è‡´è°¢

æœ¬é¡¹ç›®ä½¿ç”¨ **Claude Code + Gemini CLI + Codex** é…åˆ Vibe Coding æ–¹å¼å¼€å‘ã€‚

çµæ„Ÿæ¥æºï¼š[Linux.do å¸–å­](https://linux.do/t/topic/1397944/49)

---

## è´¡çŒ®

æ¬¢è¿Žæäº¤ Issue å’Œ PRï¼

```bash
# Fork é¡¹ç›®åŽ
git checkout -b feature/your-feature
git commit -m "feat: add your feature"
git push origin feature/your-feature
```
